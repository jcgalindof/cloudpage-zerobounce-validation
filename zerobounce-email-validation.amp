%%[
  SET @KeysDE = "Encrypted_Keys"
  SET @ProjectURL = "https://mcfmxk1g37c1jn91t2tp6mmtn3l1.pub.sfmc-content.com/t2ta1i15edl"
  SET @Rows = LookupRows(@KeysDE, "Project_URL", @ProjectURL)
  SET @RowCount = RowCount(@Rows)
  IF @RowCount > 0 THEN
    SET @Row = Row(@rows, 1)
    SET @str = Field(@Row, "CLIENT_SECRET")
    SET @passwordExtKey = "ZeroBounceKey"
    SET @saltExtKey = "ZeroBounceSalt"
    SET @initVectorExtKey = "ZeroBounceVector"
    SET @DecAES = DecryptSymmetric(@str, "aes", @passwordExtKey, @null, @saltExtKey, @null, @initVectorExtKey, @null)
    ]%%
      <script runat="server">
        /* Zero Bounce email validator */
        Platform.Load('core', '1');
        var apiKey = Platform.Variable.GetValue("@DecAES");
        var email = "thisistheend@cristobalgalindo.com" //Platform.Request.GetFormField("unique_id");
        var apiUrl = "https://api.zerobounce.net/v2/validate?api_key=" + apiKey + "&email=" + email + "&ip_address=1.1.1.1";
        var json = HTTP.Get(apiUrl);
        var parsedJSON = Platform.Function.ParseJSON(Stringify(json));
        var content = Platform.Function.ParseJSON(parsedJSON.Content);
        var status = content.status;
        Platform.Response.Write(Stringify(json));
        if (status == "valid" || status == "catch-all") {
          Platform.Variable.SetValue("@response", "true");
        } else {
          Platform.Variable.SetValue("@response", "false");
        }
      </script>
    %%[
  ELSE
    SET @DecAES = "Row Not Found"
  ENDIF
]%%
[
  {
    "decriptedApiKey" : "%%=v(@DecAES)=%%",
    "isEmailValidResponse" : "%%=v(@response)=%%"
  }
]